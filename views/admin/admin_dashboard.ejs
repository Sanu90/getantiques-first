<%- include ('partialsAdminHead') %>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item active">
          <a class="menu-link" href="/admin/dashboard">
            <i class="icon material-icons md-home"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/category">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Categories</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/user">
            <i class="icon material-icons md-add_box"></i>
            <span class="text">Users</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/product">
            <i class="icon material-icons md-add_box"></i>
            <span class="text">Products</span>
          </a>
        </li>
        
         <li class="menu-item">
          <a class="menu-link" href="/admin/order">
            <i class="icon material-icons md-store"></i>
            <span class="text">Orders</span>
          </a>
        </li>
        
        <li class="menu-item">
          <a class="menu-link" href="/admin/coupon">
            <i class="icon material-icons md-article"></i>
            <span class="text">Coupons</span>
          </a>
        </li>
      <br />
      <br />
    </nav>
  </aside>
  <main class="main-wrap">
    <header class="main-header navbar">
      <div class="col-search">
        <!-- <form class="searchform">
          <div class="input-group">
            <input
              list="search_terms"
              type="text"
              class="form-control"
              placeholder="Search term"
            />
            <button class="btn btn-light bg" type="button">
              
              <i class="material-icons md-search"></i>
            </button>
            
            </div>
          <datalist id="search_terms">
            
          </datalist>
        </form> -->
      </div>
      <div class="col-nav" onload="timeCount();">
        <p id="p1">
          
        </p>
        
    
</div>
      <div class="col-nav">
        
        <p>
          
          Welcome back, <%=name %> </p>
    
</div>


      <div class="col-nav">
            <li class="dropdown nav-item">
              <button class="btn btn-link" type="submit"> <a href="/admin/signout" ><i class="material-icons md-exit_to_app"></i>Logout</a></button>
          
            </li>
        </ul>
    </div>
      
    </header>
      <section class="content-main">
        <div class="content-header">
          <div>
            <h2 class="content-title card-title">Dashboard</h2>
            <p>Whole data about your business here</p>
          </div>
          
        </div>
        <div class="row">
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-primary-light"
                  ><i class="text-primary material-icons md-monetization_on"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Revenue</h6>
                  <span>â‚¹<%=totalRevenue[0].total_revenue %></span>
                  <span class="text-sm"> Excluding Shipping fees</span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-success-light"
                  ><i class="text-success material-icons md-local_shipping"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Orders</h6>
                  <span><%=orderData.length %></span>
                  <span class="text-sm"> All orders </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-warning-light"
                  ><i class="text-warning material-icons md-qr_code"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title">Products</h6>
                  <span><%=productData.length %></span>
                  <span class="text-sm"> In <%=categoryData.length %> Categories </span>
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
          <p>Download the reports</p>
            
            <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="cardOpt6"
                          data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Sales Report
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="cardOpt6">
                          <form id="reportForm" class="p-2" action="/admin/salesReport" method="post">
                            <h3 class="mb-3">Report</h3>
                            <div class="form-group">
                              <label for="startDate">Start Date:</label>
                              <input type="date" class="form-control" id="startDate" name="startDate">
                            </div>
                            <div class="form-group">
                              <label for="endDate">End Date:</label>
                              <input type="date" class="form-control" id="endDate" name="endDate">
                            </div>
                            <button class="btn btn-warning mt-3" type="submit">Download</button>
                          </form>
                        </div>
                      </div>
                      
                     
            
              <!--  -->
              </article>
            </div>
          </div>
        </div>
        <div class="row">
        <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-success-light"
                  ><i class="text-success material-icons md-local_shipping"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title"><u>ORDER STATUS</u></h6>
                  <% for(value of productStatus){ %>
                  <h5><%=value._id %> : <%=value.count %> </h5>
                  <% } %>
                  
                </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-primary-light"
                  ><i class="text-primary material-icons md-monetization_on"></i
                ></span>
                <div class="text">
                  <h6 class="mb-1 card-title"><u>TRANSACTIONS</u></h6>
                  <% for(value of transaction){ %>
                  <h5><%=value._id %> : <%=value.count %> </h5>
                  <% } %>
                   </div>
              </article>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <!-- <span class="icon icon-sm rounded-circle bg-primary-light"
                  ><i class="text-primary material-icons md-monetization_on"></i
                ></span> -->
                <div class="text">
                  <h6 class="mb-1 card-title"><u>BEST SELLING PRODUCTS</u></h6>
                  <% for(value of Product){ %>
                  <h5><%=value._id %> : <%=value.totalOrders %> </h5>
                  <% } %>
                  </div>
                
              </article>
              
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-body mb-4">
              <article class="icontext">
                <!-- <span class="icon icon-sm rounded-circle bg-primary-light"
                  ><i class="text-primary material-icons md-monetization_on"></i
                ></span> -->
                <div class="text">
                  <h6 class="mb-1 card-title"><u>BEST SELLING CATEGORY</u></h6>
                  <%# for(value of Product){ %>
                  <h5><%#=value._id %>Statue : 19<%#=value.totalOrders %> </h5>
                  <h5><%#=value._id %>Home Decor : 19<%#=value.totalOrders %> </h5>
                  <h5><%#=value._id %>Furniture : 18<%#=value.totalOrders %> </h5>
                  <%# } %>
                  </div>
                
              </article>
              
            </div>
          </div>
          <div class="container-fluid">
            <div>
              <label class="me-3" for="filter">Filter:</label>
              <select id="filter" class="p-1" style="color: #8a8d93; background-color: transparent;">
                  <option value="daily" selected>Daily</option>
                  <option value="monthly">Monthly</option>
                  <option value="yearly" >Yearly</option>
                </select>
              </div>
               <canvas id="salesChart" ></canvas>
               
             </div>
            </div>
          
          
          
          
          <!--  -->
          <!-- <div class="col-xl-4 col-lg-8">
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Daily</h5>
                 <canvas id="canvasId"></canvas> 
              </article>
            </div>  
          </div>  
            
           <div class="col-xl-4 col-lg-12">
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Monthly</h5>
                <canvas id="month"></canvas>
              </article>
            </div>
           </div> 
           
           <div class="col-xl-4 col-lg-12">
            <div class="card mb-4">
              <article class="card-body">
                <h5 class="card-title">Yearly</h5>
                <canvas id="year"></canvas>
              </article>
            </div>
           </div> -->
           
            
        
      </section>
      <!-- content-main end// -->
      <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script> -->
      <!-- <script src="vendor/chart.js/Chart.min.js"></script>
      <script src="js/charts-home.js"></script>
      <script src="js/front.js"></script>-->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
     
     <script>
    document.addEventListener('DOMContentLoaded', function() {

        function fetchSalesData(filter) {
          console.log("Is fetch working for bar graph--------------???");
            fetch(`/admin/sales_data?filter=${filter}`)
                .then(response => response.json())
                .then(data => {
                  console.log("Is this data response working??");
                  console.log(data);
                  console.log("Is this data response working??jhhafafjkskjfaskjhfasjhj ");
                    updateChart(data);
                })
                .catch(error => {
                    console.error('Error fetching sales data:', error);
                });
        }

        // Function to update chart with sales data
        function updateChart(data) {
    const labels = data.saleDate;
    const salesData = data.count;

    // Get the canvas element
    const ctx = document.getElementById('salesChart').getContext('2d');

    // If a chart already exists, destroy it before creating a new one
    if (window.salesChart instanceof Chart) {
        window.salesChart.destroy();
    }
    

    // Initialize Chart.js with the updated data
    window.salesChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Orders',
                data: salesData,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
}

        // Event listener for filter change
        document.getElementById('filter').addEventListener('change', function() {
            const filter = this.value;
            console.log("Filter value is:", filter);
            fetchSalesData(filter);
        });

        // Fetch initial data on page load
        fetchSalesData('daily');
    });
</script>


      <%- include ('partialsAdminFooter') %>
    
