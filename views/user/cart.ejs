<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>getantiques</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Free HTML Templates" name="keywords" />
    <meta content="Free HTML Templates" name="description" />

    <!-- Favicon -->
    <link href="../user/img/logo.png" rel="icon" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    /> -->

    <!-- Libraries Stylesheet -->
    <link
      href="../user/lib/owlcarousel/assets/owl.carousel.min.css"
      rel="stylesheet"
    />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="../user/css/style.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Topbar Start -->
    <div class="container-fluid">
      <div class="row align-items-center py-3 px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a href="/" class="text-decoration-none">
            <img src="../user/img/logo.png" width="100" />
            <!-- <h1 class="m-0 display-5 font-weight-semi-bold">
              <span class="text-primary font-weight-bold border px-3 mr-1"
                >E</span
              >Shopper
            </h1> -->
          </a>
        </div>
        <div class="col-lg-6 col-4 text-left">
          <form action="/shop" method="post">
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                placeholder="Search for products"
                name="searchValue"
              />
              <div class="input-group-append">
                <span class="input-group-text bg-transparent text-primary">
                  <i class="fa fa-search"></i>
                </span>
              </div>
            </div>
          </form>
        </div>
        <div class="col-lg-3 d-flex">
          <a href="/wishlist" class="btn border">
            <i class="fas fa-heart text-primary"></i>
            <span class="badge">0</span>
          </a>
          <a href="/cart" class="btn border">
            <i class="fas fa-shopping-cart text-primary"></i>
            <span class="badge"><%=cartCount%></span> </a
          ><br />
          <div class="dropdown">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <%=user %>
            </button>
            <ul class="dropdown-menu">
              <li>
                <button class="dropdown-item" type="button">
                  <a href="/account" style="text-decoration: none">Account</a>
                </button>
              </li>
              <!-- <li>
                <button class="dropdown-item" type="button">Log out</button>
              </li> -->
              <li>
                <button class="dropdown-item" type="button">
                  <a href="/logout" style="text-decoration: none">Logout</a>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <div class="container-fluid mb-1">
      <div class="row border-top px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a
            class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100"
            data-toggle="collapse"
            style="height: 50px; margin-top: -1px; padding: 0 30px"
          >
            <h6 class="m-0">Categories</h6>
            <i class="fa fa-angle-right text-dark"></i>
          </a>
          
        </div>
        <div class="col-lg-9">
          <nav
            class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0"
          >
            
            <button
              type="button"
              class="navbar-toggler"
              data-toggle="collapse"
              data-target="#navbarCollapse"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div
              class="collapse navbar-collapse justify-content-between"
              id="navbarCollapse"
            >
              <div class="navbar-nav mr-auto py-0">
                <% for(let i of category) {%>
                <a href="/Ucategory/<%=i.name %>" class="nav-item nav-link"
                  ><%=i.name%></a
                >
                <%}%>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>
    <!-- Navbar End -->

    <!-- Page Header Start -->
    <div class="container-fluid bg-secondary mb-5">
      <div
        class="d-flex flex-column align-items-center justify-content-center"
        style="min-height: 130px"
      >
        <h1 class="font-weight-semi-bold text-uppercase mb-3">Shopping Cart</h1>
        <div class="d-inline-flex">
          <p class="m-0"><a href="/">Home</a></p>
          <p class="m-0 px-2">-</p>
          <p class="m-0">Shopping Cart</p>
        </div>
      </div>
    </div>
    <!-- Page Header End -->

    <!-- Cart Start -->
    <div class="container-fluid pt-5">
     <% if(cartProducts.length==0){ %>
     <div class="col-lg-8 table-responsive mb-5 text-center">
     <h5>Hi <span><%=user %>, </span> Your cart is empty.</h5>
     <div class="container-fluid">
      <div class="text-center m-lg-2">
        <button
          style="margin-right: 0%"
          type="button"
          class="btn btn-outline-primary"
          onclick="location.href='/home'"
        >
          Continue Shopping
        </button>
        </div>
        </div>
     </div>
     <% } else {  %>

      <div class="row px-xl-5">
        <div class="col-lg-8 table-responsive mb-5">
          <table class="table table-bordered text-center mb-0">
            <thead class="bg-secondary text-dark">
              <tr>
                <th>Products</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Remove</th>
              </tr>
              
            </thead>
            <tbody class="align-middle">
            <% for(let i=0;i<cartProducts.length;i++){ %>
              <tr id="<%cartProducts[i].productId %>">
                    <td class="align-middle">
                  <img
                    src="<%=cartProducts[i].productImage[0] %>"
                    alt=""
                    style="width: 50px"
                  />
                  <%=cartProducts[i].productName %>
                </td>
                <td class="align-middle">₹<%=cartProducts[i].productPrice %></td>
                
                
                <td class="align-middle">
                  <div
                    class="input-group quantity mx-auto"
                    style="width: 100px"
                  >
                    <div class="input-group-btn">
                      <button class="btn btn-sm btn-primary btn-minus" id="minusButton" onclick = "update(`<%= cartProducts[i].productId %>`,-1)">
                      <i class="fa fa-minus"></i>
                      </button>
                      </div>
                    <input
                      type="text" id="<%= cartProducts[i].productId %>+hello"
                      class="form-control form-control-sm bg-secondary text-center"
                      value="<%=cartProducts[i].productQuantity%>"
                    />
                    
                    <div class="input-group-btn">
                        <button class="btn btn-sm btn-primary btn-plus" id="addButton" onclick = "update(`<%= cartProducts[i].productId %>`,1)">
                        <i class="fa fa-plus"></i>
                      </button>
                    </div>
                  </div>
                </td>
                <td class="align-middle" id="<%= cartProducts[i].productId %>+hai">₹<%=cartProducts[i].productPrice * cartProducts[i].productQuantity %></td>
                <td class="align-middle">
                <button class="btn btn-sm btn-primary btn-delete" data-product-id="<%= cartProducts[i].productId %>">
                <i class="fa fa-times"></i>
                </button>
                </td> 
                
                  </tr>
                  <% } %>
                </tbody>
            </table>
          </div>
            <div class="col-lg-4">
                
            <div class="card border-secondary mb-5">
            <div class="card-header bg-secondary border-0">
              <h4 class="font-weight-semi-bold m-0">Cart Summary</h4>
            </div>
            
            </div>
            <div class="card-footer border-secondary bg-transparent">
              <div class="d-flex justify-content-between mt-2">
                <h5 class="font-weight-bold">Total</h5>
                <p class="font-weight-bold" id="total">₹<%=total %></p>
              </div>
              <a href="/checkout" style="text-decoration: none;" ><button class="btn btn-block btn-primary my-3 py-3" type="submit">
                Proceed To Checkout
              </button></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% } %>
    <!-- Cart End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-secondary text-dark mt-5 pt-5">
      <div class="row px-xl-5 pt-5">
        <div class="col-lg-4 col-md-12 mb-5 pr-3 pr-xl-5">
          <a href="" class="text-decoration-none">
            <h1 class="mb-4 display-5 font-weight-semi-bold">
              <span
                class="text-primary font-weight-bold border border-white px-3 mr-1"
                >E</span
              >Shopper
            </h1>
          </a>
          <p>
            Dolore erat dolor sit lorem vero amet. Sed sit lorem magna, ipsum no
            sit erat lorem et magna ipsum dolore amet erat.
          </p>
          <p class="mb-2">
            <i class="fa fa-map-marker-alt text-primary mr-3"></i>123 Street,
            New York, USA
          </p>
          <p class="mb-2">
            <i class="fa fa-envelope text-primary mr-3"></i>info@example.com
          </p>
          <p class="mb-0">
            <i class="fa fa-phone-alt text-primary mr-3"></i>+012 345 67890
          </p>
        </div>
        <div class="col-lg-8 col-md-12">
          <div class="row">
            <div class="col-md-4 mb-5">
              <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
              <div class="d-flex flex-column justify-content-start">
                <a class="text-dark mb-2" href="index.html"
                  ><i class="fa fa-angle-right mr-2"></i>Home</a
                >
                <a class="text-dark mb-2" href="shop.html"
                  ><i class="fa fa-angle-right mr-2"></i>Our Shop</a
                >
                <a class="text-dark mb-2" href="detail.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shop Detail</a
                >
                <a class="text-dark mb-2" href="cart.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a
                >
                <a class="text-dark mb-2" href="checkout.html"
                  ><i class="fa fa-angle-right mr-2"></i>Checkout</a
                >
                <a class="text-dark" href="contact.html"
                  ><i class="fa fa-angle-right mr-2"></i>Contact Us</a
                >
              </div>
            </div>
            <div class="col-md-4 mb-5">
              <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
              <div class="d-flex flex-column justify-content-start">
                <a class="text-dark mb-2" href="index.html"
                  ><i class="fa fa-angle-right mr-2"></i>Home</a
                >
                <a class="text-dark mb-2" href="shop.html"
                  ><i class="fa fa-angle-right mr-2"></i>Our Shop</a
                >
                <a class="text-dark mb-2" href="detail.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shop Detail</a
                >
                <a class="text-dark mb-2" href="cart.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a
                >
                <a class="text-dark mb-2" href="checkout.html"
                  ><i class="fa fa-angle-right mr-2"></i>Checkout</a
                >
                <a class="text-dark" href="contact.html"
                  ><i class="fa fa-angle-right mr-2"></i>Contact Us</a
                >
              </div>
            </div>
            <div class="col-md-4 mb-5">
              <h5 class="font-weight-bold text-dark mb-4">Newsletter</h5>
              <form action="">
                <div class="form-group">
                  <input
                    type="text"
                    class="form-control border-0 py-4"
                    placeholder="Your Name"
                    required="required"
                  />
                </div>
                <div class="form-group">
                  <input
                    type="email"
                    class="form-control border-0 py-4"
                    placeholder="Your Email"
                    required="required"
                  />
                </div>
                <div>
                  <button
                    class="btn btn-primary btn-block border-0 py-3"
                    type="submit"
                  >
                    Subscribe Now
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row border-top border-light mx-xl-5 py-4">
        <div class="col-md-6 px-xl-0">
          <p class="mb-md-0 text-center text-md-left text-dark">
            &copy;
            <a class="text-dark font-weight-semi-bold" href="#"
              >Your Site Name</a
            >. All Rights Reserved. Designed by
            <a
              class="text-dark font-weight-semi-bold"
              href="https://htmlcodex.com"
              >HTML Codex</a
            ><br />
            Distributed By
            <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
          </p>
        </div>
        <div class="col-md-6 px-xl-0 text-center text-md-right">
          <img class="img-fluid" src="../user/img/payments.png" alt="" />
        </div>
      </div>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"
      ><i class="fa fa-angle-double-up"></i
    ></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="../user/lib/easing/easing.min.js"></script>
    <script src="../user/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="../user/mail/jqBootstrapValidation.min.js"></script>
    <script src="../user/mail/contact.js"></script>
    <script src="
https://cdn.jsdelivr.net/npm/sweetalert2@11.10.6/dist/sweetalert2.all.min.js
"></script>

    <!-- Template Javascript -->
    <script src="../user/js/main.js"></script>

<script>

// Add event listener to all delete buttons - SWEET ALERT //
document.addEventListener("DOMContentLoaded", function() {
  const deleteButtons = document.querySelectorAll(".btn-delete");
  deleteButtons.forEach(function(button) {
    button.addEventListener("click", function() {
      const productId = button.dataset.productId;
      console.log(productId); //consoles the product ID in browser //
      Swal.fire({
        title: 'Are you sure?',
        text: "You are about to remove this product from cart.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, remove !'
      }).then((result) => {
        if (result.isConfirmed) {
          fetch(`/removeCart`,{
            method:'post',
            headers: {
                    'Content-Type': 'application/json',
                },
                  body: JSON.stringify({
                    productId: productId,
                    }),
          })  // fetch closed //
          .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                }).then(data=>{
                  if(data.success){
                    window.alert(data.message);
                    window.location.reload();
                  }
                })
        }   // if closed //
      });  //.then closed//
    }); // addEventListener button closed //
  });  //forEach closed//
});    //addEventListener closed //

//reduce the product count in the cart //

// function minus(id){
//   let a=document.getElementById(id);
//   let b=document.getElementById(total)
//   let c=document.getElementById(quantity);
//    console.log("minus", id);
//   fetch(`/minusCartvalue`,{
//             method:'post',
//             headers: {
//                     'Content-Type': 'application/json',
//                 },
//                   body: JSON.stringify({
//                     productId: id,
//                     }),
                    
//           }).then(response => {
//                     if (!response.ok) {
//                         throw new Error('Network response was not ok');
//                     }
//                     return response.json();
//                 }).then(data=>{
                  
//                   if(data.productCount==1){
                    
//                       // window.location.reload();
//                     }
//                     console.log(data)
//                     console.log('hello --------------')
//                     document.getElementById('productTotal').innerHTML = "hello"
//                   console.log("json.productTotalValue ..." , data.productTotalValue);                  
//                     a.innerText = "₹"+data.productTotalValue;
//                    //window.location.reload(); 
//                   console.log("hhfgyfyyfyfyff");
//                 })
         
// }



//control the product count in the cart //

function update(id,val){
    console.log("Product id is:", id);
    console.log("Value is: ", val)
    console.log("***********************************************");
    // const inputs = document.querySelectorAll('input'); 
    // inputs.forEach(input=>{
    //   input.addEventListener('change', (event)=>{
    //     console.log(`New value: ${event.target.value}`);
        
    //   })
    // }) 
    // console.log("***********************************************");

    // let quantity = Number(document.getElementById('quantity').value);
    //  console.log("quantity is: ", quantity);
      fetch(`/addCartvalue`,{
            method:'post',
            headers: {
                    'Content-Type': 'application/json',
                },
                  body: JSON.stringify({
                    productId: id,
                    value :val,
                    // quantity:quantity
                    }),
                    
          }).then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                }).then(data=>{
                  if(data.value==1){
                            console.log(data.message);
                            // `${pro}+hai`
                            // let a = document.getElementById("quantity")
                            // a.value = data.proStock;
                            document.getElementById(`${id}+hello`).value = data.proStock;
                            Swal.fire({
                                      icon: "error",
                                      title: "Oops...",
                                      text: "No more stocks available",
                                      footer: 'getantiques'
                                                });
                           // window.alert(data.message)
                            console.log(data.proStock);
                            
                  }
                  else if(data.value==0)
                  {
                  // let quantity = document.getElementById('quantity').value
                  // console.log(quantity,'quantityquantityquantityquantity')
                
                    console.log(data.productPrice,'----------------------')
                    console.log(data,'********************')
                    let b=document.getElementById('total')
                    //console.log(b,'bbbbbbbbb')
                    b.innerText = "₹"+data.totalPriceSum
                    document.getElementById(`${id}+hai`).innerText = "₹"+ data.productPrice
                    console.log("json.productTotalValue ..." , data.productTotalValue);                  
                    a.innerText = "₹"+data.productTotalValue;
                    console.log("hhfgyfyyfyfyff");
                   //window.location.reload();  
                  }
                })
}

</script>

  </body>
</html>
