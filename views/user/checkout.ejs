<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>getantiques</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Free HTML Templates" name="keywords" />
    <meta content="Free HTML Templates" name="description" />

    <!-- Favicon -->
    <link href="../user/img/logo.png" rel="icon" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    /> -->

    <!-- Libraries Stylesheet -->
    <link
      href="../user/lib/owlcarousel/assets/owl.carousel.min.css"
      rel="stylesheet"
    />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="../user/css/style.css" rel="stylesheet" />
    <style>
      .custom-control-input {
        color: brown;
      }
    </style>
  </head>

  <body>
    <!-- Topbar Start -->
    <div class="container-fluid">
      <div class="row align-items-center py-3 px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a href="/" class="text-decoration-none">
            <img src="../user/img/logo.png" width="100" />
            <!-- <h1 class="m-0 display-5 font-weight-semi-bold">
              <span class="text-primary font-weight-bold border px-3 mr-1"
                >E</span
              >Shopper
            </h1> -->
          </a>
        </div>
        <div class="col-lg-6 col-4 text-left">
          <!-- <form action="/shop" method="post">
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                placeholder="Search for products"
                name="searchValue"
              />
              <div class="input-group-append">
                <span class="input-group-text bg-transparent text-primary">
                  <i class="fa fa-search"></i>
                </span>
              </div>
            </div>
          </form> -->
        </div>
        <div class="col-lg-3 d-flex">
          <!-- <a href="" class="btn border">
            <i class="fas fa-heart text-primary"></i>
            <span class="badge">0</span>
          </a> -->
          <!-- <a href="/cart" class="btn border">
            <i class="fas fa-shopping-cart text-primary"></i>
            <span class="badge"><%#=cartCount%></span> </a
          ><br /> -->
          <div class="dropdown">
          <p style="visibility: hidden;" id="userName"><%=user %></p>
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false" 
            >
              <%=user %>
              
            </button>
            
            <ul class="dropdown-menu">
              <li>
                <button class="dropdown-item" type="button">
                  <a href="/account" style="text-decoration: none">Account</a>
                </button>
              </li>
              <!-- <li>
                <button class="dropdown-item" type="button">Log out</button>
              </li> -->
              <li>
                <button class="dropdown-item" type="button">
                  <a href="/logout" style="text-decoration: none">Logout</a>
                </button>
              </li>
            </ul>
          </div>

          <!-- <a href="/register" class="nav-item nav-link">Register</a> -->
        </div>

        <!-- <div class="col-lg-3 col-6 text-right">
          <a href="/login" class="nav-item nav-link">Login</a>
          <a href="/register" class="nav-item nav-link">Register</a>
          <a href="" class="btn border">
            <i class="fas fa-heart text-primary"></i>
            <span class="badge">0</span>
          </a>
          <a href="" class="btn border">
            <i class="fas fa-shopping-cart text-primary"></i>
            <span class="badge">0</span>
          </a>
        </div> -->
      </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <div class="container-fluid mb-1">
      <div class="row border-top px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a
            class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100"
            data-toggle="collapse"
            style="height: 50px; margin-top: -1px; padding: 0 30px"
          >
            <h6 class="m-0">Categories</h6>
            <i class="fa fa-angle-right text-dark"></i>
          </a>
          <!-- <nav
            class="collapse show navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0"
            id="navbar-vertical"
          >
            <div class="navbar-nav w-100 overflow-hidden" style="height: 150px">
              <%# for(let i of category) {%>
              <a href="" class="nav-item nav-link"><%#=i.name%></a> <%# } %>
            </div>
          </nav> -->
        </div>
        <div class="col-lg-9">
          <nav
            class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0"
          >
            <button
              type="button"
              class="navbar-toggler"
              data-toggle="collapse"
              data-target="#navbarCollapse"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div
              class="collapse navbar-collapse justify-content-between"
              id="navbarCollapse"
            >
              <div class="navbar-nav mr-auto py-0">
                <% for(let i of category) {%>
                <a href="/Ucategory/<%=i.name %>" class="nav-item nav-link"
                  ><%=i.name%></a
                >
                <%}%>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>
    <!-- Navbar End -->

    <!-- Page Header Start -->
    <div class="container-fluid bg-secondary mb-5">
      <div
        class="d-flex flex-column align-items-center justify-content-center"
        style="min-height: 150px"
      >
        <h1 class="font-weight-semi-bold text-uppercase mb-3">Checkout</h1>
        <div class="d-inline-flex">
          <p class="m-0"><a href="/">Home</a></p>
          <p class="m-0 px-2">-</p>
          <p class="m-0"><a href="/cart">Cart</a></p>
          <p class="m-0 px-2">-</p>
          <p class="m-0">Checkout</p>
        </div>
      </div>
    </div>
    <!-- Page Header End -->

    <!-- Checkout Start -->
    <div class="container-fluid pt-5">
      <!-- from here -->
      <div class="row px-xl-5">
        <div class="col-lg-8">
          <!-- to here -->
          <!-- <div class="mb-4"> -->
          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="shipto" />
            <label
              class="custom-control-label"
              for="shipto"
              data-toggle="collapse"
              data-target="#shipping-address"
              >Add a delivery address from here</label
            >
          </div>
          <div class="collapse mb-4" id="shipping-address">
            <br />
            <h4 class="font-weight-semi-bold mb-4">New Shipping Address</h4>

            <form action="/saveNewAddressfromCheckout" method="post">
            <!-- <form method="post"> -->
              <div class="row">
                <div class="col-md-6 form-group">
                  <label>Full name<span style="color: red">*</span></label>
                  <input
                    class="form-control"
                    type="text"
                    placeholder="Full name"
                    name="fullname"
                    required
                  />
                </div>

                <div class="col-md-6 form-group">
                  <label>Mobile Number<span style="color: red">*</span></label>
                  <input
                    class="form-control"
                    type="text"
                    maxlength="10"
                    min="6000000000"
                    placeholder="Mobile Number"
                    name="mobile"
                    required
                  />
                </div>
                <div class="col-md-6 form-group">
                  <label>House name<span style="color: red">*</span></label>
                  <input
                    class="form-control"
                    type="text"
                    placeholder="House name"
                    name="house"
                    required
                  />
                </div>
                <div class="col-md-6 form-group">
                  <label>Street<span style="color: red">*</span></label>
                  <input
                    class="form-control"
                    type="text"
                    placeholder="Street"
                    name="street"
                    required
                  />
                </div>
                <div class="col-md-6 form-group">
                  <label>City<span style="color: red">*</span></label>
                  <input
                    class="form-control"
                    type="text"
                    placeholder="City"
                    name="city"
                    required
                  />
                </div>
                <div class="col-md-6 form-group">
                  <label>State<span style="color: red">*</span></label>
                  <select class="custom-select" required name="state">
                    <option selected value="" disabled>Choose One</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                  </select>
                </div>
                <div class="col-md-6 form-group">
                  <label>Country<span style="color: red">*</span></label>
                  <select class="custom-select" name="country">
                    <option selected value="India">India</option>
                  </select>
                </div>

                <div class="col-md-6 form-group">
                  <label>Pin Code<span style="color: red">*</span></label>
                  <input
                    class="form-control"
                    type="text"
                    placeholder="Pin Code"
                    maxlength="6"
                    minlength="6"
                    name="pincode"
                    required
                  />
                </div>
              </div>
              <button
                type="submit"
                class="btn btn-primary"
                onclick="addressSaved()"
              >
                Save & use
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="row px-xl-5">
      <div class="col-lg-8">
        <div class="mb-4">
          <!-- let form starts here -->
          <!-- <form action="/test" method="post"> -->
          <!-- <form action= "/orderProduct" method="post"> -->
          <div class="col-xxl">
          <% if (address.length > 0){ %>
            <h4 class="font-weight-semi-bold mb-4" style="padding-top: 50px">
              Select a delivery address from below
            </h4>
            <% } %>
            <% for(let i = 0; i < address.length; i++) { %>
            <div class="custom-control custom-radio" style="margin: 35px">
              <input type="radio" class="custom-control-input" name="address"
              value="<%=address[i]._id%>"
              id="<%= address[i]._id %>" <% if (i === 0) { %> checked <% } %> />
              <label class="custom-control-label" for="<%= address[i]._id %>"
                ><%= address[i].customerName + ", " + address[i].mobile
                %></label
              >
              <p>
                <%= address[i].houseName + ", " + address[i].street + ", " +
                address[i].city + ", " + address[i].state + ", " +
                address[i].country + " - " + address[i].pincode %>
              </p>
            </div>
            <% } %>

            <!-- Payment button starts -->
            <div class="card border-secondary mb-10 mx-auto" style="max-width: 500px; margin-top: 100px;">
                    <div class="card-header bg-secondary border-0">
                      <h4 class="font-weight-semi-bold m-0 text-center">Payment</h4>
                    </div>
                    <div class="card-body">
                      <div class="form-group">
                        <div class="custom-control custom-radio">
                          <input
                            type="radio"
                            class="custom-control-input"
                            id="cod"
                            name="payment"
                            value="Cash on Delivery"
                            checked
                          />
                          <label class="custom-control-label" for="cod">Pay on Delivery</label>
                        </div>
                      </div>
                          <div class="form-group">
                        <div class="custom-control custom-radio">
                          <input
                            type="radio"
                            class="custom-control-input"
                            id="razorpay"
                            name="payment"
                            value="Online"
                          />
                          <label class="custom-control-label" for="razorpay">Razorpay</label>
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <div class="custom-control custom-radio">
                        <% if(wallet.wallet < totalCheckoutCharge){ %>
                          <input
                            type="radio"
                            class="custom-control-input"
                            id="wallet"
                            name="payment"
                            value="wallet" disabled
                          />
                          <label class="custom-control-label" for="wallet">Wallet</label>
                          
                          <span style="font-size: small;">(₹<%=wallet.wallet%>)</span><br>
                          <span style="font-size: small; color: red;" >Your wallet balance is low</span>
                        
                          <%  } else if(wallet.wallet >= totalCheckoutCharge){%>
                          <input
                            type="radio"
                            class="custom-control-input"
                            id="wallet"
                            name="payment"
                            value="wallet" 
                          />
                          
                          <label class="custom-control-label" for="wallet">Wallet</label>
                          
                          <span style="font-size: small;">(₹<%=wallet.wallet%>)</span>
                          <% } %>
                        </div>
                      </div>
                      
                      
                    </div>
                    <div class="card-footer border-secondary bg-transparent">
                      <button type="button" onclick="pay()" class="btn btn-lg btn-block btn-primary font-weight-bold my-3 py-3">Place Order</button>
                    </div>
                  </div>
            <!-- Payment button  ends -->
            </div>
          <!-- </form> -->
            <!-- let form ends here -->
            
          </div>
        </div>
        <div class="col-lg-4">
        <!-- <form class="mb-5" action="/applycoupon" method="post"> -->
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control p-4"
                      placeholder="Coupon Code"
                      couponName="coupon"
                      id="coupon"
                      value=""
                      
                    />
                    <div class="input-group-append">
                    <button type="button" class="btn btn-primary" id="applyCouponBtn" onclick="coupon(`1`)">Apply</button>
                    <p></p>
                    <button type="button" style="display: none;"  class="btn btn-primary"id="remove-button" onclick="coupon(`0`)">Remove</button>
                    </div>
                    
                  </div>
                  <span class="text-danger" style="display: inline-block; padding: 10px; " id="couponMessage"></span>
                  <br><br><br><br>
                <!-- </form> -->
          <div class="card border-secondary mb-5">
            <div class="card-header bg-secondary border-0">
              <h4 class="font-weight-semi-bold m-0">Order Total</h4>
            </div>
            <div class="card-body">
              <h5 class="font-weight-medium mb-3">Products</h5>
              <% for(let i=0;i<(checkoutPageValues.length);i++){ %>
              <div class="d-flex justify-content-between">
                <p><%=checkoutPageValues[i].productName %></p>
                <p>&#215;<%=checkoutPageValues[i].productQuantity %></p>
                <p>
                  ₹&nbsp;&nbsp;&nbsp;<%=checkoutPageValues[i].productDiscountPrice
                  *checkoutPageValues[i].productQuantity %>
                </p>
                <!-- <p>
                  ₹&nbsp;&nbsp;&nbsp;<%#=totalAmount%>
                </p> -->
              </div>
              <% } %>
              <hr class="mt-0" />
              <!-- <div class="d-flex justify-content-between mb-3 pt-1">
                <h6 class="font-weight-medium">Subtotal</h6>
                <h6 class="font-weight-medium">₹<%#=totalAmount%></h6>
              </div> -->
              
              <div class="d-flex justify-content-between">
                <h6 class="font-weight-medium">Discount (if any):</h6>
                <h6 class="font-weight-medium" id="discount"></h6>
              </div>
              <br>
              <div class="d-flex justify-content-between">
                <h6 class="font-weight-medium">Shipping</h6>
                <%# if(totalAmount < 200000){ %>
                <h6 class="font-weight-medium">₹<%=shippingCharges %></h6>
                <%# }else{ %>
                <!-- <h6 class="font-weight-medium">₹ 0</h6> -->
                <%# } %>
                
              </div>
              
            </div>
            <div class="card-footer border-secondary bg-transparent">
              <div class="d-flex justify-content-between mt-2">
                <h5 class="font-weight-bold">Total</h5>
                <h5
                  class="font-weight-bold"
                  id="cartTotalValue"
                  name="cartTotalValue"
                >
                  <%=totalCheckoutCharge%>
                </h5>
              </div>
            </div>
          </div>
          <!-- earlier payment button was starting from here -->

          <!-- payment method ended here  -->
        </div>
      </div>
    </div>
    <!-- Checkout End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-secondary text-dark mt-5 pt-5">
      <div class="row px-xl-5 pt-5">
        <div class="col-lg-4 col-md-12 mb-5 pr-3 pr-xl-5">
          <a href="" class="text-decoration-none">
            <h1 class="mb-4 display-5 font-weight-semi-bold">
              <span
                class="text-primary font-weight-bold border border-white px-3 mr-1"
                >E</span
              >Shopper
            </h1>
          </a>
          <p>
            Dolore erat dolor sit lorem vero amet. Sed sit lorem magna, ipsum no
            sit erat lorem et magna ipsum dolore amet erat.
          </p>
          <p class="mb-2">
            <i class="fa fa-map-marker-alt text-primary mr-3"></i>123 Street,
            New York, USA
          </p>
          <p class="mb-2">
            <i class="fa fa-envelope text-primary mr-3"></i>info@example.com
          </p>
          <p class="mb-0">
            <i class="fa fa-phone-alt text-primary mr-3"></i>+012 345 67890
          </p>
        </div>
        <div class="col-lg-8 col-md-12">
          <div class="row">
            <div class="col-md-4 mb-5">
              <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
              <div class="d-flex flex-column justify-content-start">
                <a class="text-dark mb-2" href="index.html"
                  ><i class="fa fa-angle-right mr-2"></i>Home</a
                >
                <a class="text-dark mb-2" href="shop.html"
                  ><i class="fa fa-angle-right mr-2"></i>Our Shop</a
                >
                <a class="text-dark mb-2" href="detail.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shop Detail</a
                >
                <a class="text-dark mb-2" href="cart.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a
                >
                <a class="text-dark mb-2" href="checkout.html"
                  ><i class="fa fa-angle-right mr-2"></i>Checkout</a
                >
                <a class="text-dark" href="contact.html"
                  ><i class="fa fa-angle-right mr-2"></i>Contact Us</a
                >
              </div>
            </div>
            <div class="col-md-4 mb-5">
              <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
              <div class="d-flex flex-column justify-content-start">
                <a class="text-dark mb-2" href="index.html"
                  ><i class="fa fa-angle-right mr-2"></i>Home</a
                >
                <a class="text-dark mb-2" href="shop.html"
                  ><i class="fa fa-angle-right mr-2"></i>Our Shop</a
                >
                <a class="text-dark mb-2" href="detail.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shop Detail</a
                >
                <a class="text-dark mb-2" href="cart.html"
                  ><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a
                >
                <a class="text-dark mb-2" href="checkout.html"
                  ><i class="fa fa-angle-right mr-2"></i>Checkout</a
                >
                <a class="text-dark" href="contact.html"
                  ><i class="fa fa-angle-right mr-2"></i>Contact Us</a
                >
              </div>
            </div>
            <div class="col-md-4 mb-5">
              <h5 class="font-weight-bold text-dark mb-4">Newsletter</h5>
              <form action="">
                <div class="form-group">
                  <input
                    type="text"
                    class="form-control border-0 py-4"
                    placeholder="Your Name"
                    required="required"
                  />
                </div>
                <div class="form-group">
                  <input
                    type="email"
                    class="form-control border-0 py-4"
                    placeholder="Your Email"
                    required="required"
                  />
                </div>
                <div>
                  <button
                    class="btn btn-primary btn-block border-0 py-3"
                    type="submit"
                  >
                    Subscribe Now
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row border-top border-light mx-xl-5 py-4">
        <div class="col-md-6 px-xl-0">
          <p class="mb-md-0 text-center text-md-left text-dark">
            &copy;
            <a class="text-dark font-weight-semi-bold" href="#"
              >Your Site Name</a
            >. All Rights Reserved. Designed by
            <a
              class="text-dark font-weight-semi-bold"
              href="https://htmlcodex.com"
              >HTML Codex</a
            ><br />
            Distributed By
            <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
          </p>
        </div>
        <div class="col-md-6 px-xl-0 text-center text-md-right">
          <img class="img-fluid" src="img/payments.png" alt="" />
        </div>
      </div>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"
      ><i class="fa fa-angle-double-up"></i
    ></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="../user/lib/easing/easing.min.js"></script>
    <script src="../user/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    

    <!-- Contact Javascript File -->
    <script src="../user/mail/jqBootstrapValidation.min.js"></script>
    <script src="../user/mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="../user/js/main.js"></script>

    <script>

      function addressSaved() {
        console.log("address saved");
        window.alert("Your address is saved.");
      }

      // coupon //
      function coupon(value){
        var couponText = document.getElementById("coupon").value;
        var couponError = document.getElementById("couponMessage");
        var discount = document.getElementById("discount");
        var cartTotal = document.getElementById("cartTotalValue");
        
        console.log("hii apply coupon clicked");
        console.log("value of button:" ,value)
        //console.log(typeof(value));
        console.log("value entered in text box:" ,couponText);
        if(value == 1){
        let a = document.getElementById('applyCouponBtn');
        let b= document.getElementById('remove-button');
        fetch(`/applyCoupon`,{
          method:"POST",
          headers: {
                    'Content-Type': 'application/json',
                },
                  body: JSON.stringify({
                    name: couponText,
                    value: value,
                    }),
                    }).then(response => {
                    console.log(response);
                    console.log("jggjtyhkjkhhqqqw");
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                    }).then(data=>{
                        couponError.innerText = data.message;
                        discount.innerText = data.discount;
                        cartTotal.innerText = data.total_cart_value;
                    //window.location.reload();
       
                    if (data.buttonChange===0){
                      let a =document.getElementById('remove-button');
                    let b= document.getElementById('applyCouponBtn');
                      a.style.display="none";
                    b.style.display="inline-block";
                    }else{
                    let b= document.getElementById('applyCouponBtn');
                    b.style.display="none";
                    let a =document.getElementById('remove-button');
                    a.style.display="inline-block";
                    
                    inputElement.value="";
                    console.log("Hello2");
                    
                    } })
                }

          if(value == 0){

              console.log("USER TRYING TO REMOVE COUPON ");
            let a = document.getElementById('remove-button');
            let b = document.getElementById('applyCouponBtn');
            fetch(`/removeCoupon`,{
            method:"POST",
            headers: {
                    'Content-Type': 'application/json',
                },
                  body: JSON.stringify({
                    name: couponText,
                    value: value,
                    }),
          }).then(response => {
                    console.log(response);
                    console.log("response from remove coupon");
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                    }).then(data=>{
                        couponError.innerText = data.message;
                        discount.innerText = data.discount;
                        cartTotal.innerText = data.total_cart_value;

                  if (data.buttonChange===0){
                      let a = document.getElementById('remove-button');
                      let b = document.getElementById('applyCouponBtn');
                      a.style.display="none";
                      b.style.display="inline-block";
                    }

          })

         }
      }
      // coupon end //
      //

      setTimeout(()=>{
        document.getElementById("couponMessage").textContent = errorMessage;
        let msg11 = document.getElementById("couponMessage");
        msg11.textContent = ""; 
      }, 2000)


      function pay(){
        console.log("*****************************");
        
        // if(selectedAddress===null){
        const userName = document.getElementById("userName").innerHTML;
        console.log("userName is:" ,userName);
       
        fetch(`/addressCheck`,{
          method: "POST",
          headers:{
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            userName: userName,
          })
        }).then(response=>{
          console.log(response);
          if(!response.ok){
            throw new Error("Error happened in validating address")
          }
          return response.json();
        }).then(data=>{
          console.log("response data is:" ,   data);
            window.alert(data.message)
        })
        // }
        
         console.log("PAY is invoked");
      const selectedAddress = document.querySelector('input[name="address"]:checked').value;
      const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
      const cartTotal = Number(document.getElementById("cartTotalValue").innerText);
      const discount = Number (document.getElementById("discount").innerText);
    
      console.log("************************");
      console.log("Address is:" ,selectedAddress);
      console.log("payment is:" ,selectedPayment);
      console.log("Amount is: ", cartTotal);
      console.log(typeof cartTotal);
      console.log("Discount applied is ", discount);
      console.log(typeof discount);
      if(selectedPayment=="Cash on Delivery"){
        console.log("Hello COD");
        fetch(`/cash-on-delivery`,{
          method: "POST",
          headers:{
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            addressID: selectedAddress,
            payment: selectedPayment, 
            amount: cartTotal,
            discount: discount,
          })
        }).then(response=>{
          console.log(response);
          if(!response.ok){
            throw new Error("Error happened in getting response for COD purchase response")
          }
          return response.json();
        }).then(data=>{
          console.log(data.message);
          console.log("check check check for response on COD");
          window.location.href="/orderPlaced"
        })
      }else if(selectedPayment=="Online"){
        //var cartTotal = document.getElementById("cartTotalValue").innerText;
        console.log("cartTotal is:" ,cartTotal);
        console.log("Hello Razorpay");
        		$.ajax({
			url:"/pay-by-razorpay",
			type:"POST",
			data: {addressID: selectedAddress,
            payment: selectedPayment,
            amount: cartTotal,
            discount: discount,
      },
			success:function(res){
				if(res.success){
					var options = {
						"key": ""+res.key_id+"",
						"amount": ""+res.amount+"",
						"currency": "INR",
						"name": "getantiques",
						// "description": ""+res.description+"",
						// "image": "https://dummyimage.com/600x400/000/fff",
						"order_id": ""+res.order_id+"",
						"handler": function (response){
              console.log("address id is: ", selectedAddress);
							 //alert("Payment Succeeded");
							 window.open(`/cash-on-delivery?addressID=${selectedAddress}&payment=${selectedPayment}`,"_self")
						},
						// "prefill": {
						// 	"contact":""+res.contact+"",
						// 	"name": ""+res.name+"",
						// 	"email": ""+res.email+""
						// },
						// "notes" : {
						// 	"description":""+res.description+""
						// },
						"theme": {
							"color": "#2300a3"
						}
					};
					var razorpayObject = new Razorpay(options);
					razorpayObject.on('payment.failed', function (response){
							alert("Payment Failed");
              console.log("Is this hitting?????--------------->failed");
                  window.open(`/razorpay-PaymentFailed?addressID=${selectedAddress}&payment=${selectedPayment}&status=failed`,"_self")
              
					});
					razorpayObject.open();
				}
				else{
					 alert(res.msg);
           console.log("Razorpay Payment is success");

          // window.location.href=`/cash-on-delivery?addressID =${selectedAddress}&payment=${selectedPayment}`
          
				}
			}
		})

      }else if(selectedPayment=="wallet"){
        console.log("Hello Wallet");
        fetch(`/payby-Wallet`,{
          method: "POST",
          headers:{
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            addressID: selectedAddress,
            payment: selectedPayment,
            amount: cartTotal,
            discount: discount,
          })
        })
        .then(response=>{
          console.log(response);
          if(!response.ok){
            throw new Error("Error happened in getting response for COD purchase response")
          }
          return response.json();
        }).then(data=>{
          console.log(data.message);
          console.log("checking response on wallet");
          window.location.href="/orderPlaced"
        })
      }
      }



      //

//     $(document).ready(function(){
// 	$('#razorpay').submit(function(e){
// 		e.preventDefault();

    

// 		var formData = $(this).serialize();

// 		$.ajax({
// 			url:"/createOrder",
// 			type:"POST",
// 			data: formData,
// 			success:function(res){
// 				if(res.success){
// 					var options = {
// 						"key": ""+res.key_id+"",
// 						"amount": ""+res.amount+"",
// 						"currency": "INR",
// 						"name": ""+res.product_name+"",
// 						// "description": ""+res.description+"",
// 						// "image": "https://dummyimage.com/600x400/000/fff",
// 						"order_id": ""+res.order_id+"",
// 						"handler": function (response){
// 							alert("Payment Succeeded");
// 							// window.open("/","_self")
// 						},
// 						// "prefill": {
// 						// 	"contact":""+res.contact+"",
// 						// 	"name": ""+res.name+"",
// 						// 	"email": ""+res.email+""
// 						// },
// 						// "notes" : {
// 						// 	"description":""+res.description+""
// 						// },
// 						"theme": {
// 							"color": "#2300a3"
// 						}
// 					};
// 					var razorpayObject = new Razorpay(options);
// 					razorpayObject.on('payment.failed', function (response){
// 							alert("Payment Failed");
// 					});
// 					razorpayObject.open();
// 				}
// 				else{
// 					alert(res.msg);
// 				}
// 			}
// 		})

// 	});
// });



    </script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  </body>
</html>
